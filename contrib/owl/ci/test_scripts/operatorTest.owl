--cleanup environment
drop owltable testOwlTable within owldatabase testOwldatabase;
drop owltable testOwlTable1 within owldatabase testOwldatabase;
drop owltable testOwlTable2 within owldatabase testOwldatabase;
drop owldatabase testOwldatabase;

--Initialize environment
create owldatabase testOwldatabase identified by storage directory "hdfs://namenode:8080/data/testowldatabase";

select owldatabase objects where owldatabase in (testOwldatabase);

create owltable type basic testOwlTable within owldatabase testOwldatabase define property key retention:INTEGER partitioned by LIST with partition key year:INTEGER define property key month:INTEGER, date:INTEGER schema "test1:int";

create owltable type basic testOwlTable1 within owldatabase testOwldatabase define property key retention:INTEGER partitioned by LIST with partition key year:INTEGER define property key month:INTEGER, date:INTEGER schema "test1:int";

create owltable type basic testOwlTable2 within owldatabase testOwldatabase define property key domain:STRING partitioned by LIST with partition key country:STRING define property key climate:STRING, date:INTEGER schema "test1:int";

publish dataelement to owltable testOwlTable within owldatabase testOwldatabase partition (year = 2009) property (retention = 1, month = 8, date = 1) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http"; 

-- uncomment the following line when the publish bug is fixed
-- two publish statements with same kvps goes through
-- publish dataelement to owltable testOwlTable within owldatabase testOwldatabase partition (year = 2009) property (retention = 1, month = 8, date = 1) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http1"; 

publish dataelement to owltable testOwlTable within owldatabase testOwldatabase partition (year = 2008) property (retention = 0, month = 7, date = 0) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http2"; 

publish dataelement to owltable testOwlTable within owldatabase testOwldatabase partition (year = 2010) property (retention = 2, month = 9, date = 2) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http3"; 


publish dataelement to owltable testOwlTable1 within owldatabase testOwldatabase partition (year = 2009) property (retention = 1, month = 8, date = 1) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http4"; 

publish dataelement to owltable testOwlTable1 within owldatabase testOwldatabase partition (year = 2008) property (retention = 0, month = 7, date = 0) schema "c1:collection(r1:reocrd(f1:int, f2:int))" delocation "http5"; 

publish dataelement to owltable testOwlTable1 within owldatabase testOwldatabase partition (year = 2010) property (retention = 2, month = 9, date = 2) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http6"; 


publish dataelement to owltable testOwlTable2 within owldatabase testOwldatabase partition (country = "usa") property (domain = "us", climate = "windy", date = 1) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http7"; 

publish dataelement to owltable testOwlTable2 within owldatabase testOwldatabase partition (country = "india") property (domain = "asia", climate = "sunny", date = 10) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http8"; 

publish dataelement to owltable testOwlTable2 within owldatabase testOwldatabase partition (country = "london") property (domain = "uk", climate = "rainy", date = 11) schema "c1:collection(r1:record(f1:int, f2:int))" delocation "http9"; 


--select dataelements
select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year >= 2009) property ( month >= 8, date >= 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year = 2009) property ( month = 8, date = 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year <= 2009) property ( month <= 8, date <= 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year < 2009) property ( month < 8, date < 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year > 2009) property ( month > 8, date > 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year > 2011) property ( month > 8, date > 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year < 2007) property ( month < 8, date < 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year > 2009) property ( month < 8, date < 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year < 2009) property ( month > 8, date > 1);

select dataelement objects from owltable testOwlTable within owldatabase testOwldatabase with partition ( year < 2009) property ( month >= 8, date >= 1);


select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year >= 2009) property ( month >= 8, date >= 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year = 2009) property ( month = 8, date = 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year <= 2009) property ( month <= 8, date <= 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year < 2009) property ( month < 8, date < 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year > 2009) property ( month > 8, date > 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year > 2011) property ( month > 8, date > 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year < 2007) property ( month < 8, date < 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year > 2009) property ( month < 8, date < 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year < 2009) property ( month > 8, date > 1);

select dataelement objects from owltable testOwlTable1 within owldatabase testOwldatabase with partition ( year < 2009) property ( month >= 8, date >= 1);


select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%us%") property ( climate LIKE "%dy%");

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%us%") property ( climate LIKE "%dy%", date > 2);

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%us%") property ( climate LIKE "%dy%", date >= 2);

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%in%") property ( climate LIKE "%dy%", date >= 2);

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%in%") property ( climate LIKE "%y%", date >= 2);

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%l%") property ( climate LIKE "%%", date >= 2);

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%%") property ( climate LIKE "%%", date >= 2);

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%%") property ( climate LIKE "%%", date <= 2);

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%%") property ( climate LIKE "%%");

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country LIKE "%a%") property ( climate LIKE "%%");

select dataelement objects from owltable testOwlTable2 within owldatabase testOwldatabase with partition ( country = "%a%") property ( climate LIKE "%%");


--select partition property

select partitionproperty objects from owltable testOwlTable  within owldatabase testOwldatabase with partition ( year = 2009 );

-- Uncomment the following line after the testDriver is fixed to validate the partitionproperties uniquely
-- select partitionproperty objects from owltable testOwlTable  within owldatabase testOwldatabase with partition ( year >= 2009 );

-- Uncomment the following line after the testDriver is fixed to validate the partitionproperties uniquely
-- select partitionproperty objects from owltable testOwlTable  within owldatabase testOwldatabase with partition ( year <= 2009 );

select partitionproperty objects from owltable testOwlTable  within owldatabase testOwldatabase with partition ( year < 2009 );

select partitionproperty objects from owltable testOwlTable  within owldatabase testOwldatabase with partition ( year > 2009 );

select partitionproperty objects from owltable testOwlTable  within owldatabase testOwldatabase with partition ( year > 2011 );

select partitionproperty objects from owltable testOwlTable  within owldatabase testOwldatabase with partition ( year < 2007 );


select partitionproperty objects from owltable testOwlTable1  within owldatabase testOwldatabase with partition ( year = 2009 );

-- Uncomment the following line after the testDriver is fixed to validate the partitionproperties uniquely
-- select partitionproperty objects from owltable testOwlTable1  within owldatabase testOwldatabase with partition ( year >= 2009 );

-- Uncomment the following line after the testDriver is fixed to validate the partitionproperties uniquely
-- select partitionproperty objects from owltable testOwlTable1  within owldatabase testOwldatabase with partition ( year <= 2009 );

select partitionproperty objects from owltable testOwlTable1  within owldatabase testOwldatabase with partition ( year < 2009 );

select partitionproperty objects from owltable testOwlTable1  within owldatabase testOwldatabase with partition ( year > 2009 );

select partitionproperty objects from owltable testOwlTable1  within owldatabase testOwldatabase with partition ( year > 2011 );

select partitionproperty objects from owltable testOwlTable1  within owldatabase testOwldatabase with partition ( year < 2007 );


select partitionproperty objects from owltable testOwlTable2  within owldatabase testOwldatabase with partition ( country LIKE "%us%" );

-- Uncomment the following line after the testDriver is fixed to validate the partitionproperties uniquely
-- select partitionproperty objects from owltable testOwlTable2  within owldatabase testOwldatabase with partition ( country LIKE "%a%" );

select partitionproperty objects from owltable testOwlTable2  within owldatabase testOwldatabase with partition ( country = "%a%" );


--tests for operators on string
select dataelement objects from owltable testOwlTable2  within owldatabase testOwldatabase with partition ( country < "india" );
select dataelement objects from owltable testOwlTable2  within owldatabase testOwldatabase with partition ( country <= "india" );
select dataelement objects from owltable testOwlTable2  within owldatabase testOwldatabase with partition ( country > "india" );
select dataelement objects from owltable testOwlTable2  within owldatabase testOwldatabase with partition ( country >= "india" );

--cleanup
drop owltable testOwlTable within owldatabase testOwldatabase;
drop owltable testOwlTable1 within owldatabase testOwldatabase;
drop owltable testOwlTable2 within owldatabase testOwldatabase;
drop owldatabase testOwldatabase;
