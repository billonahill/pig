--cleanup environment
drop owltable testschema1 within owldatabase testSchemaAlterDB;
drop owltable testschema2 within owldatabase testSchemaAlterDB;
drop owldatabase testSchemaAlterDB;

--Initialize environment
create owldatabase testSchemaAlterDB identified by
 storage directory "http://namenode:8080/data/testSchemaAlterDBdir";  

create owltable type basic testschema1 within owldatabase testSchemaAlterDB schema "test1:int";
create owltable type basic testschema2 within owldatabase testSchemaAlterDB  partitioned by LIST with partition key year:INTEGER partitioned by LIST with partition key month:INTEGER  schema "c1:int,c2:record(c22:collection(c222:record(c2222:bool)))";

--test table 1
publish dataelement to owltable testschema1 within owldatabase testSchemaAlterDB schema "c1:int" delocation "testloc1nopart";
describe owltable testschema1 within owldatabase testSchemaAlterDB;

alter owltable testschema1 within owldatabase testSchemaAlterDB set schema "test2:int";
describe owltable testschema1 within owldatabase testSchemaAlterDB;

select partition objects from owltable testschema1 within owldatabase testSchemaAlterDB;


--test table 2
publish dataelement to owltable testschema2 within owlDatabase testSchemaAlterDB partition (year = 2009, month = 1) schema "x1:int,c2:record(c22:collection(c222:record(c2222:bool)))" delocation "testloc1"; 
publish dataelement to owltable testschema2 within owlDatabase testSchemaAlterDB partition (year = 2009, month = 2) schema "y1:int,c2:record(c22:collection(c222:record(c2222:bool)))" delocation "testloc2"; 
--drop x1
alter owltable testschema2 within owldatabase testSchemaAlterDB set schema "c2:record(c22:collection(c222:record(c2222:bool))),c1:int,y1:int";
describe owltable testschema2 within owldatabase testSchemaAlterDB;

publish dataelement to owltable testschema2 within owlDatabase testSchemaAlterDB partition (year = 2009, month = 3) schema "z1:int" delocation "testloc3"; 
describe owltable testschema2 within owldatabase testSchemaAlterDB;

alter owltable testschema2 within owldatabase testSchemaAlterDB set schema "y1:int,year:int,month:int,c1:int";
describe owltable testschema2 within owldatabase testSchemaAlterDB;

select partition objects from owltable testschema2 within owldatabase testSchemaAlterDB;

--cleanup
drop owltable testschema1 within owldatabase testSchemaAlterDB;
drop owltable testschema2 within owldatabase testSchemaAlterDB;
drop owldatabase testSchemaAlterDB;
